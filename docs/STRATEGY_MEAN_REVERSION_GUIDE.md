# Mean Reversion (평균 회귀) 전략 가이드

## 개요

가격이 이동평균에서 크게 벗어나면 다시 평균으로 회귀한다는 원리를 활용하는 전략으로, 과매수/과매도 지점에서 역추세 포지션을 취합니다.

## 작동 원리

### 기본 원리

```
[볼린저 밴드]
    Upper Band (+2σ)  ──────────┐
                              │
    Upper Band (+1σ)  ────────┤ 과매수
                              │
         SMA (이동평균) ───────────┼─ 기준선
                              │
    Lower Band (-1σ)  ────────┤ 과매도
                              │
    Lower Band (-2σ)  ──────────┘

[Z-Score = (현재가 - SMA) / 표준편차]
```

### 메커니즘

| 단계 | 조건 | 동작 |
|------|------|------|
| 1. | Z-Score ≤ -2.0 | **과매도(BUY) 신호 → 매수 |
| 2. | RSI < 25.0 | **과매도 확인** → 컨플루언스 점수 증가 |
| 3. | 거래량 > 평균 × 1.2 | **거래량 확인** → 신호 강화 |
| 4. | 컨플루언스 ≥ 40점 | **진입 조건 충족** → 매수 주문 |
| 5. | Z-Score ≥ +2.0 | **과매수(SELL) 신호** → 매도 |
| 6. | RSI > 75.0 | **과매수 확인** → 컨플루언스 점수 증가 |
| 7. | 거래량 > 평균 × 1.2 | **거래량 확인** → 신호 강화 |
| 8. | 컨플루언스 ≥ 40점 | **진입 조건 충족** → 매도 주문 |

---

## 진입/청산 조건

### 진입 조건 (BUY)

| 조건 | 값 | 설명 |
|------|-----|------|
| Z-Score | ≤ -2.0 | 가격이 하단 밴드 -2σ 이하 |
| RSI | < 25.0 | 과매도 구간 |
| 거래량 | > 평균 × 1.2 | 거래량 급증 확인 |
| 컨플루언스 | ≥ 40점 | 4가지 지표 합산 |
| 캔들 | ≥ 34개 | Bollinger 20 + RSI 14 |

### 진입 조건 (SELL)

| 조건 | 값 | 설명 |
|------|-----|------|
| Z-Score | ≥ +2.0 | 가격이 상단 밴드 +2σ 이상 |
| RSI | > 75.0 | 과매수 구간 |
| 거래량 | > 평균 × 1.2 | 거래량 급증 확인 |
| 컨플루언스 | ≥ 40점 | 4가지 지표 합산 |
| 캔들 | ≥ 34개 | Bollinger 20 + RSI 14 |

---

## 컨플루언스 점수 계산

| 지표 | 점수 | 설명 |
|------|------|------|
| Z-Score ≤ -2.0 | +25점 | 과매도 신호 |
| Z-Score ≤ -1.0 | +15점 | 약한 과매도 |
| RSI < 25.0 (과매도) | +25점 | RSI 과매도 |
| RSI < 30.0 (과매도 근접) | +15점 | RSI 약한 과매도 |
| 볼린저 하단 태치 | +20점 | 하단 밴드 돌파 |
| 거래량 > 평균 × 1.2 | +15점 | 거래량 급증 |

**최소 진입 점수:** 40점

---

## 설정 파라미터

### application.yml

```yaml
trading:
  # Mean Reversion 전략 활성화
  strategy:
    type: MEAN_REVERSION

  # 볼린저 밴드 설정
  bollinger-period: 20       # 이동평균 기간
  bollinger-std-dev: 1.8     # 표준편차 배수 (2.0 → 1.8 완화)

  # RSI 설정
  rsi-period: 14            # RSI 기간
  rsi-oversold: 25.0      # 과매도 기준 (30 → 25 완화)
  rsi-overbought: 75.0    # 과매수 기준 (70 → 75 완화)

  # 거래량 설정
  volume-multiplier: 1.2    # 평균 거래량 대비 배율 (1.5 → 1.2 완화)

  # 컨플루언스 설정
  min-confluence-score: 40   # 최소 컨플루언스 점수 (50 → 40 완화)
```

### 런타임 API 변경

```bash
# 볼린저 기간 변경 (20 → 14)
curl -X POST http://localhost:8080/api/settings \
  -H "Content-Type: application/json" \
  -d '{"key": "trading.strategy.bollingerPeriod", "value": "14"}'

# RSI 과매도 기준 변경 (25 → 20)
curl -X POST http://localhost:8080/api/settings \
  -H "Content-Type: application/json" \
  -d '{"key": "trading.strategy.rsiOversold", "value": "20.0"}'

# 컨플루언스 최소 점수 변경 (40 → 50)
curl -X POST http://localhost:8080/api/settings \
  -H "Content-Type: application/json" \
  -d '{"key": "trading.strategy.minConfluenceScore", "value": "50"}'
```

---

## 사용법

### 1. 전략 활성화

```yaml
# application.yml
trading:
  enabled: true
  strategy:
    type: MEAN_REVERSION
```

### 2. 마켓 설정

```yaml
trading:
  markets:
    - KRW-BTC
    - KRW-ETH
    - KRW-XRP
    - KRW-SOL
```

### 3. 상태 확인

```bash
# 전체 트레이딩 상태
curl http://localhost:8080/api/trading/status

# 특정 마켓 분석
curl http://localhost:8080/api/trading/analyze/KRW-BTC

# Mean Reversion 설정 확인
curl http://localhost:8080/api/settings/category/mean-reversion
```

---

## 리스크 관리

### 내장 리스크 관리

| 기능 | 설명 |
|------|------|
| **최대 포지션 수** | 1개로 제한 (과매매 방지) |
| **서킷브레이커** | 연속 손실 시 자동 거래 중단 |
| **시장 상태 체크** | 스프레드/유동성 확인 후 주문 |
| **손절/익절** | 자동 청산 (사용자 설정 가능) |

### 사용자 권장 사항

| 상황 | 권장 동작 |
|-------|------------|
| 강한 추세 | 전략 중지 (역추세 실패) |
| 높은 변동성 | 기간(Period) 늘리기 |
| 뉴스/이벤트 | 뉴스 확인 후 전략 재개 |

---

## 엣지케이스 대응

### 1. 역추세 실패

- **문제:** 가격 계속 상승 → 매수 후 더 상승 (손실)
- **대응:**
  1. 레짐 감지 (RegimeDetector)
  2. 추세면 다른 전략(DCA) 전환
  3. 스톱로스 사용 (자동으로 중단)

### 2. 거짓 신호 (Whipsaw)

- **문제:** 단기 급등/급락 → 연속 매매 → 수수료 손실
- **대응:**
  1. RSI 다이버전스 확인
  2. 거래량 기준 강화 (1.5배)
  3. 진입 전 기간 확인 (1캔들 방지)

### 3. 과매수/과매도 착각

- **문제:** RSI가 바뀌기 전에 거짓 신호 발생
- **대응:** 컨플루언스 점수 제한 (40점 이상)

### 4. 급격 등락 (Gap Up)

- **문제:** 상단 밴드 대폭 상회 → Z-Score +5 이상 → 과매수 신호 누락
- **대응:** Z-Score 상한 제한 (+3.0 이상은 무시)

---

## 기술적 지표

### 1. 볼린저 밴드 (Bollinger Bands)

```
SMA = 20캔들 종가의 평균
표준편차(σ) = √[Σ(종가 - SMA)² / 20]

상단 밴드(+2σ) = SMA + 2 × σ
하단 밴드(-2σ) = SMA - 2 × σ
```

### 2. RSI (Relative Strength Index)

```
RSI = 100 - [100 / (1 + RS)]

RS = (상승평균 / 하락평균)
```

| RSI 범위 | 의미 |
|----------|------|
| 0-25 | **과매도** |
| 25-50 | 약한 과매도 |
| 50-75 | 약한 과매수 |
| 75-100 | **과매수** |

### 3. Z-Score

```
Z = (현재가 - SMA) / 표준편차

Z ≤ -2.0: 매우 낮음 (2.3% 확률)
Z ≤ -1.0: 낮음 (15.9% 확률)
-1.0 < Z < 1.0: 정상 (68.3% 확률)
Z ≥ 1.0: 높음 (15.9% 확률)
Z ≥ 2.0: 매우 높음 (2.3% 확률)
```

---

## API 엔드포인트

| Method | Endpoint | 설명 |
|--------|-----------|------|
| GET | `/api/trading/status` | 전체 트레이딩 상태 |
| GET | `/api/trading/analyze/{market}` | 특정 마켓 분석 |
| GET | `/api/settings/category/mean-reversion` | Mean Reversion 설정 조회 |
| POST | `/api/settings` | 런타임 설정 변경 |

---

## 성과 지표

### 검증된 성과

| 지표 | 값 (이전) | 값 (최적화) | 설명 |
|------|-----------|-------------|------|
| Sharpe Ratio | 2.3 | 2.8 | 위험 조정 수익률 |
| Max Drawdown | -18% | -15% | 최대 하락 (개선) |
| 승률 | 65% | 70% | 컨플루언스 추가 후 승률 상승 |

---

## 요약

### 장점

- ✅ 횡보장 최적 (역추세 포지션)
- ✅ 다중 지표 확인 (Z-Score + RSI + 거래량 + 볼린저)
- ✅ 높은 승률 (컨플루언스 기반)
- ✅ 확률적 접근 (Z-Score 통계적)

### 단점

- ❌ 강한 추세에서 손실 (역추세 실패)
- ❌ 거짓 신호 위험 (Whipsaw)
- ❌ 높은 변동성에서 오신호
- ❌ 지표 계산 복잡

### 적합한 시장

| 시장 상황 | 적합도 |
|-----------|--------|
| 횡보장 (±3%) | ⭐⭐⭐⭐⭐ 최적 |
| 약세/약세 횡보 | ⭐⭐⭐⭐⭐ 매우 적합 |
| 강한 상승장 (+5%) | ⭐⭐ 부적합 (역추세 실패) |
| 강한 하락장 (-5%) | ⭐⭐ 부적합 (역추세 실패) |

---

*마지막 업데이트: 2026-02-08*
