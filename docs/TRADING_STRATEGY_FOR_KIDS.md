# 코인 자동 거래 시스템 설명서

가장 쉽게 이해할 수 있는 트레이딩 전략 가이드

---

## 1. 시스템 개요

이 시스템은 Spring Boot 기반 코인 자동 거래 봇입니다. 빗썸 거래소 API를 연동하여 24시간 자동으로 매매를 수행합니다.

### 기술 스택
- Java 25 + Kotlin 2.3.0
- Spring Boot 3.5.9
- Spring AI 1.1.2 (Anthropic Claude + OpenAI GPT)
- MySQL 8.x
- Docker 배포

---

## 2. 활성화된 트레이딩 전략

현재 5가지 전략이 운영 중입니다.

### 2.1 DCA (Dollar Cost Averaging)

정기적으로 일정 금액을 투자하는 장기 전략입니다.

| 파라미터 | 값 |
|---------|-----|
| 주기 | 8시간 |
| 1회 투자금 | 10,000원 |
| 대상 마켓 | BTC, ETH, XRP, SOL |

**특징:**
- 시장 타이밍을 고민하지 않고 꾸준히 투자
- 변동성이 큰 시장에서 평균 단가 낮추는 효과

### 2.2 Grid Trading

가격이 특정 구간에서 움직일 때 매수/매도를 반복합니다.

| 파라미터 | 값 |
|---------|-----|
| 그리드 레벨 | 5개 |
| 그리드 간격 | 1% |
| 기준가 | 최근 50일 평균 |

**작동 예시:**
```
기준가 100,000원일 때:
- 99,000원 → 매수
- 100,000원 → 매수
- 101,000원 → 매도
- 102,000원 → 매도
```

**적합 시장:** 횡보장 (가격이 일정 범위에서 왔다갔다)

### 2.3 Mean Reversion (평균 회귀)

가격이 평균에서 크게 벗어났을 때, 다시 평균으로 돌아오는 성질을 이용합니다.

| 파라미터 | 값 |
|---------|-----|
| Z-Score 임계값 | 1.2 |
| RSI 과매도 | 75 |
| RSI 과매도 | 25 |
| 볼린저 표준편차 | 1.8 |

**진입 조건 (매수):**
- Z-Score ≤ -1.2 (평균보다 1.2표준편차 이하로 하락)
- RSI ≤ 25 (과매도 구간)
- 볼린저 하단 돌파

**진입 조건 (매도):**
- Z-Score ≥ 1.2
- RSI ≥ 75
- 볼린저 상단 돌파

### 2.4 Volume Surge (거래량 급등 단타)

거래량이 갑자기 급등하는 종목을 포착하여 단타 매매합니다.

| 파라미터 | 값 |
|---------|-----|
| 거래량 비율 기준 | 150% (20일 평균 대비) |
| 최소 컨플루언스 | 40점 |
| 최대 RSI | 80 |
| 손절 | -3% |
| 익절 | +6% |
| 포지션 타임아웃 | 60분 |

**컨플루언스 점수 산정:**
- 거래량 스파이크: 최대 35점
- 가격 스파이크: 최대 25점
- 호가창 Imbalance: 최대 15점
- RSI 구간: 최대 15점
- MACD 신호: 최대 10점

**특징:**
- LLM이 뉴스를 검색하여 펌프앤덤프 필터링
- 동일 마켓 60분 쿨다운 (LLM API 비용 절감)

### 2.5 Meme Scalper (세력 코인 단타)

소형 코인의 펌프를 감지하여 초단타로 진입합니다.

| 파라미터 | 값 |
|---------|-----|
| 거래량 스파이크 | 500% 이상 |
| 가격 스파이크 | 3% 이상 |
| 호가 Imbalance | 0.3 이상 |
| 손절 | -1.5% |
| 익절 | +3% |
| 타임아웃 | 15분 |

**특징:**
- 5초마다 전체 마켓 스캔
- 대형 코인 제외 (BTC, ETH 등 20개)
- 1시간 TTL 캐시로 비상장 코인 재시드 최소화

---

## 3. 리스크 관리

### 3.1 다단계 리스크 체크

1. **시장 조건 검사**
   - 1분 변동성 1.5% 이상
   - 호가창 유동성 5배 이상
   - 스프레드 0.5% 이하

2. **포지션 리스크**
   - 일일 손실 한도: 5만원
   - 연속 손실 한도: 3~5회
   - 동시 포지션: 최대 5개

3. **서킷 브레이커**
   - API 연속 실패 시 차단
   - 슬리피지 1% 이상 시 차단
   - 일일 손실 한도 도달 시 중단

### 3.2 동적 손절 (ATR 기반)

레짐별로 손절 거리를 다르게 적용합니다.

| 레짐 | ATR 배수 | 설명 |
|------|----------|------|
| 횡보 | 1.5x | 타이트한 손절 |
| 추세 | 3.0x | 여유있는 손절 |
| 고변동 | 4.0x | 넓은 손절 |

---

## 4. 시스템 아키텍처

```
┌─────────────────────────────────────────────────────┐
│                    Trading Engine                   │
│  - 5초마다 시장 스캔                                │
│  - 전략 선택 및 실행                                 │
│  - ReentrantLock으로 동시성 제어                     │
└─────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        ▼                 ▼                 ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ Volume Surge │  │Meme Scalper  │  │ Mean Reversion│
│ (30초 폴링)  │  │ (5초 폴링)   │  │  (5초 폴링)   │
└──────────────┘  └──────────────┘  └──────────────┘
        │                 │                 │
        └─────────────────┼─────────────────┘
                          ▼
                ┌──────────────────┐
                │ Bithumb API      │
                │ (매수/매도 주문) │
                └──────────────────┘
```

---

## 5. 최근 성과

| 전략 | 거래 횟수 | 승률 | 손익 |
|------|----------|------|------|
| Volume Surge | 1건 (최근 30일) | - | -211원 |
| Meme Scalper | 다수 | 분석 중 | 소액 ± |
| DCA | 정기적 | - | 장기 수익 예상 |
| Grid | 활발 | 약 60% | 양호 |

---

## 6. 설정 파일

### application.yml 주요 설정

```yaml
trading:
  enabled: true
  markets: [KRW-BTC, KRW-ETH, KRW-XRP, KRW-SOL]
  order-amount-krw: 10000
  strategy:
    type: MEAN_REVERSION
    mean-reversion-threshold: 1.2

volumesurge:
  enabled: true
  min-volume-ratio: 1.5
  max-rsi: 80
  stop-loss-percent: -3.0
  take-profit-percent: 6.0

memescalper:
  enabled: true
  stop-loss-percent: -1.5
  take-profit-percent: 3.0
  polling-interval-ms: 5000
```

---

## 7. 용어 설명

| 용어 | 설명 |
|------|------|
| **Z-Score** | 평균에서 얼마나 떨어져 있는지 (표준편차 단위) |
| **RSI** | 상대강도지수 (0~100), 70 이상 과매수, 30 이하 과매도 |
| **볼린저 밴드** | 이동평균을 중심으로 한 가격 변동폭 밴드 |
| **슬리피지** | 주문 시도 가격과 실제 체결 가격의 차이 |
| **컨플루언스** | 여러 지표가 동시에 같은 신호를 보내는 현상 |
| **펌프앤덤프** | 세력이 가격을 인위적으로 올렸다 내리는 사기 |

---

## 8. 개선이 필요한 부분

### 해결된 문제
1. **동시성 문제** - ReentrantLock으로 해결
2. **비상장 코인 캐시** - 1시간 TTL로 해결
3. **과도한 WARN 로그** - DEBUG 레벨로 조정

### 사용자가 직접 처리할 부분
1. **DB 인덱스** - 사용자가 직접 생성 예정
2. **Funding Arbitrage** - Phase 2 자동 거래 미구현

---

## 9. 모니터링

### 시스템 상태 확인
```bash
curl http://localhost:8080/api/volume-surge/status
curl http://localhost:8080/api/memescalper/status
curl http://localhost:8080/api/trading/status
```

### 로그 확인
```bash
docker logs -f coin-trading-server --tail 100
```

---

*이 문서는 시스템의 전체 구조와 각 전략의 작동 방식을 빠르게 파악하기 위한 참고 자료입니다.*
