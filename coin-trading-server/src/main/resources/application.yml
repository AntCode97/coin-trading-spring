server:
  port: 8080

spring:
  application:
    name: coin-trading-server
  main:
    banner-mode: off
    keep-alive: true  # Virtual Thread 사용 시 JVM 유지

  # Virtual Thread 활성화 (Java 21+)
  threads:
    virtual:
      enabled: true

  # Google GenAI만 비활성화 (project-id 필수 문제)
  autoconfigure:
    exclude:
      - org.springframework.ai.autoconfigure.chat.model.googlegenai.GoogleGenAiChatAutoConfiguration

  # MySQL 설정
  datasource:
    url: ${MYSQL_URL:jdbc:mysql://localhost:3306/coin_trading}
    username: ${MYSQL_USER:root}
    password: ${MYSQL_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: true
    open-in-view: false

  # Spring AI 설정 (API 키가 없으면 해당 provider 비활성화)
  ai:
    # Anthropic Claude (환경변수 SPRING_AI_ANTHROPIC_API_KEY 필요)
    anthropic:
      api-key: ${SPRING_AI_ANTHROPIC_API_KEY:}
      chat:
        options:
          model: claude-sonnet-4-20250514
          max-tokens: 4096
          temperature: 0.3

    # OpenAI GPT (환경변수 SPRING_AI_OPENAI_API_KEY 필요)
    # GPT-5 시리즈는 max-tokens 대신 max-completion-tokens 사용
    openai:
      api-key: ${SPRING_AI_OPENAI_API_KEY:}
      chat:
        options:
          model: gpt-5-mini
#          max-completion-tokens: 4096
          temperature: 1

    # Google Gemini (현재 비활성화 - project-id 필수 문제)
    # google:
    #   genai:
    #     api-key: ${SPRING_AI_GOOGLE_API_KEY:}
    #     chat:
    #       options:
    #         model: gemini-3-flash-preview
    #         temperature: 0.3
    #         max-output-tokens: 4096

    # MCP Server 설정 (Stateless HTTP)
    mcp:
      server:
        enabled: true
        protocol: STATELESS
        name: coin-trading-mcp
        version: 1.0.0
        type: SYNC
        request-timeout: 30s
        instructions: |
          암호화폐 자동 매매 서버 MCP API.
          Tools: 시장 데이터, 기술적 분석, 거래 실행, 전략 관리, 성과 분석
        stateless:
          mcp-endpoint: /mcp

# Bithumb API 설정
bithumb:
  base-url: https://api.bithumb.com
  access-key: ${BITHUMB_ACCESS_KEY:}
  secret-key: ${BITHUMB_SECRET_KEY:}

# Slack Bot 알림 설정
slack:
  token: ${SLACK_TOKEN:}
  channel: ${SLACK_CHANNEL:coin-bot-alert}

# 자동 거래 설정
trading:
  enabled: ${TRADING_ENABLED:false}
  markets:
    - BTC_KRW
    - ETH_KRW
    - XRP_KRW
    - SOL_KRW
  order-amount-krw: ${ORDER_AMOUNT_KRW:10000}
  max-drawdown-percent: ${MAX_DRAWDOWN_PERCENT:10.0}
  risk-per-trade-percent: ${RISK_PER_TRADE_PERCENT:1.0}
  strategy:
    type: ${STRATEGY_TYPE:MEAN_REVERSION}
    dca-interval: ${DCA_INTERVAL:86400000}
    grid-levels: ${GRID_LEVELS:5}
    grid-spacing-percent: ${GRID_SPACING_PERCENT:1.0}
    # Mean Reversion 최적화: 1.2로 완화 (기존 2.0)
    mean-reversion-threshold: ${MEAN_REVERSION_THRESHOLD:1.2}
    # RSI 범위 확대: 25-75 (기존 30-70)
    rsi-oversold: ${RSI_OVERSOLD:25}
    rsi-overbought: ${RSI_OVERBOUGHT:75}
    bollinger-period: ${BOLLINGER_PERIOD:20}
    # 볼린저 밴드 민감도 상향: 1.8 (기존 2.0)
    bollinger-std-dev: ${BOLLINGER_STD_DEV:1.8}

# LLM 최적화 설정
llm:
  optimizer:
    enabled: ${LLM_OPTIMIZER_ENABLED:false}
    cron: ${LLM_OPTIMIZER_CRON:0 0 0 * * *}  # 매일 자정

# Logging 설정
logging:
  level:
    root: INFO
    com.ant.cointrading: DEBUG
    org.springframework.ai: INFO
    org.springframework.data.jpa: WARN
  pattern:
    console: "%d{HH:mm:ss} [%thread] %-5level %logger{20} - %msg%n"

# Volume Surge 전략 설정 (거래량 급등 단타 - 모멘텀 기반)
volumesurge:
  enabled: ${VOLUME_SURGE_ENABLED:false}
  polling-interval-ms: ${VOLUME_SURGE_POLLING_MS:30000}
  position-size-krw: ${VOLUME_SURGE_POSITION_SIZE:10000}
  max-positions: ${VOLUME_SURGE_MAX_POSITIONS:5}
  # 리스크 관리 (퀀트 최적화)
  stop-loss-percent: ${VOLUME_SURGE_STOP_LOSS:-3.0}
  take-profit-percent: ${VOLUME_SURGE_TAKE_PROFIT:6.0}
  trailing-stop-trigger: ${VOLUME_SURGE_TRAILING_TRIGGER:3.0}
  trailing-stop-offset: ${VOLUME_SURGE_TRAILING_OFFSET:1.5}
  position-timeout-min: ${VOLUME_SURGE_TIMEOUT_MIN:60}
  llm-filter-enabled: ${VOLUME_SURGE_LLM_FILTER:true}
  reflection-cron: ${VOLUME_SURGE_REFLECTION_CRON:0 0 1 * * *}
  # 쿨다운 완화: 5분 → 3분
  cooldown-min: ${VOLUME_SURGE_COOLDOWN_MIN:3}
  # LLM 쿨다운 완화: 240분 → 60분 (더 자주 재평가)
  llm-cooldown-min: ${VOLUME_SURGE_LLM_COOLDOWN_MIN:60}
  max-consecutive-losses: ${VOLUME_SURGE_MAX_LOSSES:5}
  daily-max-loss-krw: ${VOLUME_SURGE_DAILY_MAX_LOSS:50000}
  # 진입 조건 완화 (모멘텀 전략)
  min-confluence-score: ${VOLUME_SURGE_MIN_CONFLUENCE:40}
  max-rsi: ${VOLUME_SURGE_MAX_RSI:80}
  min-volume-ratio: ${VOLUME_SURGE_MIN_VOLUME_RATIO:1.5}
  # 경보 신선도 완화: 5분 → 10분
  alert-freshness-min: ${VOLUME_SURGE_ALERT_FRESHNESS:10}

# Meme Scalper 전략 설정 (세력 코인 초단타 - 펌프앤덤프 스캘핑)
memescalper:
  enabled: ${MEME_SCALPER_ENABLED:true}
  polling-interval-ms: ${MEME_SCALPER_POLLING_MS:5000}
  position-size-krw: ${MEME_SCALPER_POSITION_SIZE:6000}
  max-positions: ${MEME_SCALPER_MAX_POSITIONS:3}
  # 타이트한 손절/익절
  stop-loss-percent: ${MEME_SCALPER_STOP_LOSS:-1.5}
  take-profit-percent: ${MEME_SCALPER_TAKE_PROFIT:2.0}
  position-timeout-min: ${MEME_SCALPER_TIMEOUT_MIN:5}
  # 펌프 감지 조건
  volume-spike-ratio: ${MEME_SCALPER_VOLUME_SPIKE:5.0}
  price-spike-percent: ${MEME_SCALPER_PRICE_SPIKE:3.0}
  min-bid-imbalance: ${MEME_SCALPER_MIN_IMBALANCE:0.3}
  max-rsi: ${MEME_SCALPER_MAX_RSI:80}
  # 청산 신호
  volume-drop-ratio: ${MEME_SCALPER_VOLUME_DROP:0.3}
  imbalance-exit-threshold: ${MEME_SCALPER_IMBALANCE_EXIT:0.0}
  # 리스크 관리
  cooldown-sec: ${MEME_SCALPER_COOLDOWN_SEC:60}
  max-consecutive-losses: ${MEME_SCALPER_MAX_LOSSES:3}
  daily-max-loss-krw: ${MEME_SCALPER_DAILY_MAX_LOSS:20000}
  daily-max-trades: ${MEME_SCALPER_DAILY_MAX_TRADES:50}
  # 필터 (대형 코인 제외)
  exclude-markets:
    - KRW-BTC
    - KRW-ETH
    - KRW-XRP
    - KRW-SOL
    - KRW-ADA
    - KRW-DOGE
    - KRW-DOT
    - KRW-MATIC
  min-trading-value-krw: ${MEME_SCALPER_MIN_TRADING_VALUE:100000000}
  max-trading-value-krw: ${MEME_SCALPER_MAX_TRADING_VALUE:50000000000}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env,conditions
  endpoint:
    health:
      show-details: always
